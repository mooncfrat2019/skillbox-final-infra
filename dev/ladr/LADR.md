| **Элемент LADR** | **Содержание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| :---------------- |:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ID**            | 2025-MONITORING-1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Название**      | Принятие формата экспорта метрик Prometheus в качестве стандарта для приложений                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Дата**          | 2025-10-30                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Статус**        | Предложено (Proposed) / Принято (Accepted)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Участники**     | Архитекторы, Разработчики, Команда DevOps                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Контекст**      | На конференции был отмечен положительный опыт использования Prometheus. Наши приложения должны предоставлять метрики для централизованного сбора. Требуется стандартизировать формат этих метрик, не навязывая при этом жёсткую привязку к конкретной бэкенд-системе. Это обеспечит гибкость архитектуры и возможность миграции в будущем.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Решение**       | **Стандартизировать формат экспорта метрик для всех приложений на основе формата экспорта Prometheus.** <br> Это означает, что каждое приложение должно предоставлять HTTP-эндпоинт (например, `/metrics`), который отдаёт текстовые данные в формате, понятном для Prometheus.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Обоснование**   | 1. **Стандарт де-факто:** Формат Prometheus стал отраслевым стандартом для передачи метрик. Подавляющее большинство современных инструментов (Kubernetes, Grafana, множество библиотек) поддерживают его "из коробки". <br> 2. **Экосистема:** Существует огромное количество готовых библиотек (клиентов) для всех популярных языков программирования (Java, Go, Python, JS, .NET и др.), которые упрощают инструментирование кода. <br> 3. **Простота:** Текстовый формат прост для чтения человеком, отладки и парсинга другими системами. <br> 4. **Согласованность с окружением:** Даже если бэкенд-система будет другой (например, VictoriaMetrics, Thanos), они все являются стопроцентно совместимыми с форматом Prometheus и могут его потреблять. <br> 5. **Снижение затрат на внедрение:** Использование стандартного формата и библиотек ускоряет разработку и снижает количество кастомных решений. |
| **Последствия**   | **Положительные:** <br> - **Единообразие:** Все сервисы в архитектуре будут предоставлять метрики единым, предсказуемым способом. <br> - **Независимость от бэкенда:** Решение отделяет вопрос "как приложение отдаёт метрики" от вопроса "какая система их собирает и хранит". Это соответствует заявленному требованию "не настаивать на конкретной системе". <br> - **Быстрый старт:** Команды могут немедленно начать инструментировать свои приложения, используя стандартные библиотеки. <br><br> **Отрицательные / Риски:** <br> - **Привязка к модели данных:** Модель данных Prometheus (метрики, лейблы, типы) становится стандартом для всех. Это не является жёсткой привязкой к системе, но накладывает определённые концептуальные ограничения. <br> - **Требует обучения:** Разработчики, не знакомые с Prometheus, должны будут изучить его модель данных и форматы.                             |
| **Артефакты**     | 1. Официальная документация по формату экспорта: [Prometheus Exposition Formats](https://prometheus.io/docs/instrumenting/exposition_formats/) <br> 2. Список клиентских библиотек: [Prometheus Client Libraries](https://prometheus.io/docs/instrumenting/clientlibs/) <br> 3. Внутренний гайд по инструментированию приложений (должен быть создан).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
